# Herramientas hachas en el curso de s4vitar

## whichsystem

```
#/usr/bin/python3.8

import sys,re,subprocess

def main():
    if len(sys.argv) !=2:
        print("\n[!] Uso: python3 "+sys.argv[0]+" <direccion-ip>")
        sys.exit(1)
    else:
        ip_address=sys.argv[1]
        es_ip=re.match("\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}",ip_address)
        if es_ip:
            ttl=get_ttl(ip_address)
        else:
            print("\n[!] Debe ingresar una direccion IP con el siguiente formato:\n\n\tX.X.X.X\n\n[!] Donde X es un numero entre 0 y 255.")

def get_ttl(ip_address):
    try:
        proc = subprocess.Popen(["/usr/bin/ping -c 1 {}".format(ip_address), ""], stdout=subprocess.PIPE, shell=True)
        (out, err) = proc.communicate()
        out = out.split()
        out = out[12].decode("utf-8")
        ttl_value = re.findall(r"\d{1,3}", out)[0]
        get_os(ttl_value,ip_address)
    except:
        print("\n[!] Error al hacer ping, Host Unrechable.\n")

def get_os(ttl,ip):
    ttl=int(ttl)
    if ttl>=0 and ttl<=64:
        print("\n{} [ttl = {}] -> Linux\n".format(ip,ttl))
    elif ttl>=65 and ttl<=127:
        print("\n{} [ttl = {}] -> Windows\n".format(ip,ttl))
    else:
        print("\nSistema operativo no encontrado. ttl = {}\n".format(ttl))

if __name__ == '__main__':
    main()
```

## procmon

```
#!/bin/bash

old_process=$(ps -eo command)

while true; do
	new_process=$(ps -eo command)
	diff <(echo "$old_process") <(echo "$new_process") | grep ["\>\<"] | grep -v "kworker"
	old_process=$new_process
done
```

## port discovery

```
#!/bin/bash

if [ $1 ];then
	ip_address=$1
	for port in $(seq 1 65535);do
		timeout 1 bash -c "echo '' > /dev/tcp/$ip_address/$port" 2>/dev/null && echo "[*] Port $port - OPEN" &
	done; wait
else
	echo -e "\n[!] Uso: ./portScan.sh <ip_address>\n"
	exit 1
fi

```

## host discovery

```
#!/bin/bash

for i in $(seq 2 254);do
	timeout 1 bash -c "ping -c 1 192.168.112.$i > /dev/null 2>&1 " && echo -e "Host 192.168.112.$i - ACTIVE" &
done; wait

```

## 