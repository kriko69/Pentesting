# CONTINUACION DE ENUMERACION DE PUERTOS

## ANALISIS DE UN ESCANEO DE NMAP CON TSHARK Y TCPDUMP

Tshark es un analizador de paquetes de red, es como un wireshark pero sin interfaz grafica. 

Tcpdump es la mejor herramienta de línea de comandos en Linux y Unix para analizar e interceptar tráfico de red entrante y saliente de las redes a las que el equipo en el que se ejecuta está conectado. Son necesarios privilegios de superusuario en la mayoría de sistemas Unix para poder ejecutarlo.

Primero capturaremos los paquetes de la red con tcpdump y luego analizaremos en un text mas claro con tshark.

amos a usar un script de nmap llamado http-enum, el cual capturaremos para saber como realiza el descubrimiento de directorios de una pagina web.

```
nmap -p80 192.168.112.128 --script http-enum 
```

Podriamos utilizar el siguiente diccionario para unos mejores resultados pero tomaria mas tiempo:

```
/usr/share/wordlist/dirbuster/directory-list-2.3-medium.txt
```

Paralelamente mientras esto se ejecuta, pndremos a correr tcpdump para escuchar todas las peticiones que realiza nmap a la direccion IP victima.

```
tcpdump -i eth0 -w http-enum.cap -v

-i = definimos nuestra interfaz de red que esta en el segmento.
-w = definimos el archivo de salida con los resultados. (extension .cap)
-v = de verbose para que nos muestre cuantos paquetes va capturando (podemos poner hasta un doble verbose)
```

otros parametros de tcpdump:

```
-D = lista las interfaces de red con las que pdemoos esnifear la red.

-i eth0 icmp = ademas de declarar la interfaz de red podemos indicar el protocolo a capturar icmp, arp, tcp, udp, etc.

-i eth0 tcp port 80 = con la palabra por podemos definir que puerto esnifear.

-i eth0 tcp port 80 and src 192.168.1.100 = con la palabra "and" podemos definir varios filtros en concreto, con "src" y la direccion IP definimos una captura solo de origen indicado. Con "dst" de un destino en especifico.

-A = muestra el contenido de lo capturado en formato ASCII

-xx = muestra el contenido de lo que capturamos en formato hexadecimal y ASCII

-i eth0 not icmp = podemos excluir algun protocolo en la captura. (-i eth0 not icmp and not tcp)
``` 

Fuente: [https://rm-rf.es/tcpdump-ejemplos/](https://rm-rf.es/tcpdump-ejemplos/)

## USO DE TSHARK

Una vez ya hemos capturado con tcpdump el trafico lo podemos analizar con tshark:

```
tshark -r captura.cap
```

Damos enter y tenemos toda la informacion en bruto,asi que vamos a darle formato y filtro:

```
tshark -r captura.cap -Y "http" -Tjson 2>/dev/null

-Y = filtramos por protocolo. (http, tcp. udp, icmp, arp)
-Tjson = muestra la informacion en formato json.
```

```
tshark -r captura.cap -Y "http" -Tfields -e tcp.payload 2>/dev/null | xxd -ps -r

-Tfields -e = filtramos por un campo de la captura.

El payload del tcp es donde viaja la informacion del protocolo, lo muestra en formato hexadecimal y para traducirlo en formato legible usamos :

xxd -ps -r
```

Fuente: [https://webimprints.medium.com/un-analizador-de-paquetes-ligero-y-f%C3%A1cil-de-usar-tshark-372e4b5854e0](https://webimprints.medium.com/un-analizador-de-paquetes-ligero-y-f%C3%A1cil-de-usar-tshark-372e4b5854e0)